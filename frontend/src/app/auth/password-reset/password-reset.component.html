<div class="reset-container card" [@fadeInUp]>
  <!-- Loading state while validating token -->
  <div *ngIf="isLoading" class="loading-container" [@fadeInUp]>
    <div class="spinner"></div>
    <p>Validando token...</p>
  </div>

  <!-- Main form when token is valid -->
  <div *ngIf="!isLoading && tokenValid && !showSuccessMessage" [@fadeInUp]>
    <h2 class="form-title text-primary">Crear nueva contraseña</h2>
    <p class="form-subtitle text-secondary">Tu nueva contraseña debe ser segura y diferente a las anteriores</p>
    
    <form [formGroup]="resetForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="newPassword" class="text-primary">Nueva Contraseña</label>
        <input 
          type="password" 
          id="newPassword" 
          formControlName="newPassword"
          (input)="checkPasswordStrength()"
          class="form-control form-input"
          [class.invalid]="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched">
        
        <!-- Password strength indicator -->
        <div class="password-strength">
          <div class="strength-bar">
            <div class="strength-fill" [ngClass]="getPasswordStrengthClass()"></div>
          </div>
          <span class="strength-text" [ngClass]="getPasswordStrengthClass()">
            {{ getPasswordStrengthText() }}
          </span>
        </div>
        
        <!-- Validation error for password -->
        <div *ngIf="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched" class="error-message" [@fadeInDown]>
          <span *ngIf="resetForm.get('newPassword')?.errors?.['required']">La contraseña es requerida</span>
          <span *ngIf="resetForm.get('newPassword')?.errors?.['minlength']">La contraseña debe tener al menos 8 caracteres</span>
        </div>
      </div>
      
      <div class="form-group">
        <label for="confirmPassword" class="text-primary">Confirmar Nueva Contraseña</label>
        <input 
          type="password" 
          id="confirmPassword" 
          formControlName="confirmPassword"
          class="form-control form-input"
          [class.invalid]="resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched">
        
        <!-- Validation error for confirm password -->
        <div *ngIf="resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched" class="error-message" [@fadeInDown]>
          <span *ngIf="resetForm.get('confirmPassword')?.errors?.['required']">Debe confirmar la contraseña</span>
          <span *ngIf="resetForm.get('confirmPassword')?.errors?.['passwordMismatch']">Las contraseñas no coinciden</span>
        </div>
      </div>
      
      <button
        type="submit"
        class="btn-submit btn-primary"
        [disabled]="resetForm.invalid || isSubmitting"
        [@fadeInOut]>
        <span *ngIf="!isSubmitting">Guardar y Continuar</span>
        <span *ngIf="isSubmitting" class="btn-loading">
          <span class="btn-spinner"></span>
          Guardando...
        </span>
      </button>
    </form>
    
    <div class="auth-links">
      <a routerLink="/auth/login" class="link-primary">← Volver al inicio de sesión</a>
    </div>
  </div>

  <!-- Success message state -->
  <div *ngIf="showSuccessMessage" class="success-container" [@fadeInUp]>
    <div class="success-icon">✓</div>
    <h2 class="text-primary">¡Contraseña actualizada!</h2>
    <p class="text-secondary">Ya puedes iniciar sesión</p>
    <div class="success-links">
      <a routerLink="/auth/login" class="btn-redirect btn-primary">Ir al inicio de sesión</a>
    </div>
  </div>

  <!-- Token invalid state -->
  <div *ngIf="!isLoading && !tokenValid" class="error-container" [@fadeInUp]>
    <div class="error-icon">⚠</div>
    <h2 class="text-error">Token inválido o expirado</h2>
    <p class="text-secondary">El enlace para restablecer tu contraseña no es válido o ha expirado.</p>
    <div class="error-links">
      <a routerLink="/auth/recover" class="btn-new-request btn-primary">Solicitar nuevo enlace</a>
      <a routerLink="/auth/login" class="btn-back link-primary">← Volver al inicio de sesión</a>
    </div>
  </div>
</div>